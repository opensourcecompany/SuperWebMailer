      <form id="CampaignEditForm" name="CampaignEditForm" method="post" action="./campaignedit.php">
      <span class="Backlink"><br /><a href="./browsecampaigns.php" onclick="document.CampaignEditForm.action='./browsecampaigns.php';$('#CampaignEditForm').submit(); return false;">Zur&uuml;ck</a></span><br />
      <input type="hidden" name="PageSelected" />
      <input type="hidden" name="MailingListId" id="MailingListId" />
      <input type="hidden" name="FormId" id="FormId" />
      <input type="hidden" name="EditPage" value="1" />
      <input type="hidden" name="CampaignListId" id="CampaignListId" />
      <input type="hidden" name="SetupLevel" id="SetupLevel" value="6" />
      <input type="hidden" name="TargetGroupsSupport" id="TargetGroupsSupport" value="1" />
      <input type="hidden" name="TargetGroupsDefined" id="TargetGroupsDefined" />

      <script language="JavaScript" type="text/javascript">
      <!--
        var InnerTabListArray = Array();

        function DoShowFunctionsDialog(formId, formElementId, isfckeditor) {
          FunctionsOpen(formId, formElementId, isfckeditor);
        }

        function DoShowVariantsOfSubjectsDialog(formId, formElementId) {
          VariantsOfSubjectsOpen(formId, formElementId);
        }


        var myBasePath='';

        // default placeholders
        var arrPlaceholderItems = new Array(
            new Array('[PLACEHOLDER]', 'PLACEHOLDERTEXT')
      	    );

      	 // special placeholders for newsletter subscribe / unsubscribe
      	 var arrNewsletterUnsubscribePlaceholders = new Array(
            new Array('[NEWSLETTER_UNSUBSCRIBEPLACEHOLDER]', 'NEWSLETTER_UNSUBSCRIBEPLACEHOLDERTEXT')
      	 );

       var previousActiveElementId=null;
       var myCodeMirror=null;

      //-->
      </script>

      <link rel="stylesheet" type="text/css" href="css/scrollbox.css" />
      <script language="javascript" type="text/javascript" src="js/scrollbox.js"></script>



      <link rel="stylesheet" href="plugins/ckeditorplugins/codemirror/css/codemirror.min.css">
      <script src="plugins/ckeditorplugins/codemirror/js/codemirror.min.js"></script>
      <script src="plugins/ckeditorplugins/codemirror/js/codemirror.addons.min.js"></script>
      <script src="plugins/ckeditorplugins/codemirror/js/codemirror.addons.search.min.js"></script>
      <script src="plugins/ckeditorplugins/codemirror/js/codemirror.mode.htmlmixed.min.js"></script>

      <if:SetupComplete>
      <input type="hidden" name="SetupComplete" id="SetupComplete" value="1" />
      <div class="spacerborder">
      <table class="FormTable" cellspacing="2" cellpadding="0" border="0">
         <tbody>
           <tr>
             <td class="highlighted"><a href="#" onclick="oldSetupLevel=document.getElementById('SetupLevel').value; document.getElementById('SetupLevel').value='1';$('#CampaignEditForm').submit(); return false;">Empf&auml;ngerliste</a></td>
             <td class="highlighted"><a href="#" onclick="oldSetupLevel=document.getElementById('SetupLevel').value; document.getElementById('SetupLevel').value='2';$('#CampaignEditForm').submit(); return false;">Gruppen</a></td>
             <td class="highlighted"><a href="#" onclick="oldSetupLevel=document.getElementById('SetupLevel').value; document.getElementById('SetupLevel').value='3';$('#CampaignEditForm').submit(); return false;">Regeln</a></td>
             <td class="highlighted"><a href="#" onclick="oldSetupLevel=document.getElementById('SetupLevel').value; document.getElementById('SetupLevel').value='4';$('#CampaignEditForm').submit(); return false;">Report/Planung</a></td>
             <td class="highlighted"><a href="#" onclick="oldSetupLevel=document.getElementById('SetupLevel').value; document.getElementById('SetupLevel').value='5';$('#CampaignEditForm').submit(); return false;">Versand</a></td>
             <td class="highlighted selected"><a href="#" onclick="oldSetupLevel=document.getElementById('SetupLevel').value; document.getElementById('SetupLevel').value='6';$('#CampaignEditForm').submit(); return false;">E-Mail-Inhalt</a></td>
             <td class="highlighted"><a href="#" onclick="oldSetupLevel=document.getElementById('SetupLevel').value; document.getElementById('SetupLevel').value='7';$('#CampaignEditForm').submit(); return false;">Tracking</a></td>
             <td class="highlighted"><a href="#" onclick="oldSetupLevel=document.getElementById('SetupLevel').value; document.getElementById('SetupLevel').value='8';$('#CampaignEditForm').submit(); return false;">Zusammenfassung</a></td>
          </tr>
        </tbody>
      </table>
      </div>
      </if:SetupComplete>

      <table class="FormTable" cellspacing="0" cellpadding="0" border="0">
        <tbody>
          <tr>
            <td>

               <fieldset>
               <legend>Inhaltsangaben
               </legend>
                 <br />
                   <table class="FormTable" cellspacing="0" cellpadding="0" border="0">
                     <tbody>

                       <tr>
                        <td class="MessageDescriptionColumn" id="MailFormatLabel" name="MailFormatLabel">
                          Format der E-Mail
                        </td>
                        <td>
                          <select id="MailFormat" name="MailFormat" size="1" onchange="PageModified=true; ShowHideEMailTexts();">
                           <option value="PlainText">Reine Text-E-Mail</option>
                           <option value="HTML">Reine HTML-E-Mail (nicht empfohlen)</option>
                           <option value="Multipart">HTML- und Text-E-Mail (multipart E-Mail, empfohlen)</option>
                          </select>
                        </td>
                       </tr>

                       <tr>
                         <td class="MessageDescriptionColumn">Codierung</td>
                         <td valign="top">
                         <select name="MailEncoding" size="1" onchange="PageModified=true;">
                         <option value="iso-8859-1">Normal/Europa (iso-8859-1)</option>
                         <option value="utf-8">UTF-8</option>
                         <MAILENCODINGS></MAILENCODINGS>
                         </select>
                         </td>
                       </tr>

                       <tr>
                         <td class="MessageDescriptionColumn">Priorit&auml;t</td>
                         <td valign="top">
                         <select name="MailPriority" size="1" onchange="PageModified=true;">
                           <option value="Low">Niedrig</option>
                           <option value="Normal">Normal</option>
                           <option value="High">Hoch</option>
                         </select>
                         </td>
                       </tr>

                       <tr>
                         <td class="MessageDescriptionColumn">Bearbeitung der E-Mail</td>
                         <td valign="top">
                         <select name="MailEditType" id="MailEditType" size="1" onchange="WarnOnChangeMailEdit(); return false;">
                           <option value="Editor">Editor verwenden</option>
                           <option value="Wizard">Assistenten/Inplace Editor verwenden</option>
                           <option value="PlainSource">Reiner Quelltext</option>
                         </select>
                         </td>
                       </tr>

                       <tr>
                         <td class="MessageDescriptionColumn"><label for="Caching">Cache f&uuml;r E-Mail-Versand verwenden</label><SHOWHIDE:TOOLTIPS>
                            <img onmouseover="showTooltip(event, 'Der Cache beschleunigt den E-Mail-Versand und spart CPU-Zeit bei der Versendung von Serien-E-Mails, wenn eingebettete Bilder und Anh&auml;nge mit der E-Mail versendet werden.<br /><br />Sollten Sie E-Mails mit personalisierten Bildern versenden wollen, dann muss die Cache-Option deaktiviert werden.');return false" onmouseout="hideTooltip()" src="images/help_icon.gif" width="16" height="16" class="hintimage" alt="" />
                            </SHOWHIDE:TOOLTIPS></td>
                         <td valign="top">
                            <input type="checkbox" name="Caching" value="1" id="Caching" />
                         </td>
                       </tr>

                     </tbody>
                   </table>
               </fieldset>

               <fieldset>
               <legend>Betreff der E-Mail und Pre-Header</legend>
                 <br />
                   <table class="FormTable" cellspacing="0" cellpadding="0" border="0">
                     <tbody>
                       <tr>
                         <td colspan="2" valign="middle">

                         <select size="1" title="Feld in E-Mail-Betreff oder Pre-Header einf&uuml;gen" id="SubjectPlaceHoldersCB" onchange="InsertFieldValue('SubjectPlaceHoldersCB', previousActiveElementId ? previousActiveElementId : 'MailSubject' )" onmousedown="if(document.activeElement && document.activeElement != this){if(document.activeElement.id == 'MailSubject' || document.activeElement.id == 'MailPreHeaderText') previousActiveElementId=document.activeElement.id; else previousActiveElementId=null;}">
                           <option selected="selected">Feld zum Einf&uuml;gen w&auml;hlen...</option>
                         </select>

                         &nbsp;
                         <input type="image" src="images/blind.gif" width="24" height="24" class="FctButton ExternalButton" onclick="DoShowFunctionsDialog(this.form.id, previousActiveElementId ? previousActiveElementId : 'MailSubject', false); return false;" alt="Funktionen" title="Funktionen in E-Mail-Betreff oder Pre-Header einf&uuml;gen" style="vertical-align:bottom"  onmousedown="if(document.activeElement && document.activeElement != this){if(document.activeElement.id == 'MailSubject' || document.activeElement.id == 'MailPreHeaderText') previousActiveElementId=document.activeElement.id; else previousActiveElementId=null;}" />
                         &nbsp;
                         <input type="image" src="images/blind.gif" width="24" height="24" class="EmojiButton ExternalButton" onclick="EmojisOpen(this.form.id, previousActiveElementId ? previousActiveElementId : 'MailSubject', false); return false;" alt="Emoji einf&uuml;gen" title="Emoji in E-Mail-Betreff oder Pre-Header einf&uuml;gen" style="vertical-align:bottom"  onmousedown="if(document.activeElement && document.activeElement != this){if(document.activeElement.id == 'MailSubject' || document.activeElement.id == 'MailPreHeaderText') previousActiveElementId=document.activeElement.id; else previousActiveElementId=null;}" /><p>&nbsp;

                         <p>&nbsp;</p>

                         <label for="MailSubject">Betreff</label>&nbsp;<input type="image" src="images/blind.gif" width="22" height="22" class="ShuffleButton ExternalButton" onclick="DoShowVariantsOfSubjectsDialog('CampaignEditForm', 'MailSubject'); return false;" alt="Varianten des E-Mail-Betreffs" title="Varianten des E-Mail-Betreffs" style="vertical-align:bottom"  /><br />
                         <input type="text" name="MailSubject" id="MailSubject" size="100" maxlength="255" onchange="PageModified=true;" style="width: 99%" />
                         <br /><br />
                         <label for="MailPreHeaderText">Pre-Header</label><SHOWHIDE:TOOLTIPS>
                            <img onmouseover="showTooltip(event, 'Der Pre-Header/Vorschautext ist ein Text der von verschiedenen E-Mail-Programmen, z.B. Outlook, GoogleMail oder Thunderbird, in der E-Mail-Vorschau neuer E-Mails direkt unter oder neben dem E-Mail-Betreff angezeigt wird. Dieser Text kann, neben dem Betreff der E-Mail, verwendet werden, um den Empf&auml;nger des Newsletters zu motivieren Ihre E-Mail zu &ouml;ffnen.<br />Die L&auml;nge dieses Texts sollte zwischen 85 und 100 Zeichen liegen, l&auml;ngere Texte werden m&ouml;glicherweise abgeschnitten dargestellt.');return false" onmouseout="hideTooltip()" src="images/help_icon.gif" width="16" height="16" class="hintimage" alt="" />
                            </SHOWHIDE:TOOLTIPS><br />
                         <input type="text" name="MailPreHeaderText" id="MailPreHeaderText" size="100" onchange="PageModified=true;" style="width: 99%" />
                         <br />
                         <span name="AutoUpdateTextPartSpan" id="AutoUpdateTextPartSpan"><br />
                           <input type="checkbox" id="AutoUpdateTextPart" onclick="PageModified=true;" name="AutoUpdateTextPart" value="1" /><label for="AutoUpdateTextPart">&nbsp;Text-Teil der E-Mail automatisch aus HTML-Teil erstellen</label>
                         </span>
                         </td>
                       </tr>
                     </tbody>
                   </table>
               </fieldset>

               <!-- ##### InnerSpacer - START -->
               <div class="spacerborder">
               <!-- ##### InnerTabView - START -->
               <div id="dhtmlgoodies_HTMLTexttabView">

               <!-- ####### InnerTAB START -->
               <script language="JavaScript" type="text/javascript">
               <!--
                 InnerTabListArray.push('E-Mail im HTML-Format');
               //-->
               </script>
    	          <div class="dhtmlgoodies_aTab">
                 <br />
                   <table class="EditorTable" cellspacing="0" cellpadding="0" border="0" id="HTML">
                     <tbody>
                       <tr>
                         <td colspan="2" valign="top"><span id="MailHTMLTextWarnLabel" style="display: none;"  class="missingvaluebackground">Der HTML-Teil der E-Mail muss einen Text enthalten oder Fehler m&uuml;ssen korrigiert werden.</span>

                         <span id="ToolbarPlainSource" style="display: none;">
                          <select size="1" id="PlainHTMLPlaceHoldersCB" onchange="InsertFieldValue('PlainHTMLPlaceHoldersCB', 'MailHTMLText')">
                            <option selected="selected">Feld zum Einf&uuml;gen w&auml;hlen...</option>
                          </select>&nbsp; <input type="image" src="images/btnCustomFct.gif" onclick="DoShowFunctionsDialog('CampaignEditForm', 'MailHTMLText', false); return false;" alt="Funktionen" title="Funktionen" style="vertical-align:bottom" />&nbsp;
                           <p>&nbsp;
                          </p>
                         </span>

                         <!-- CKEditor //-->
                         <textarea name="MailHTMLText" id="MailHTMLText" cols="100" rows="10" style="width: 874px; height: 600px"></textarea>
                         <!-- /CKEditor //-->

                         <!-- IPE //-->
                         <div id="IPEWizard" class="ui-dialog-titlebar ui-corner-all ui-helper-clearfix" style="width: 100%; height: 660px; min-width: 874px; margin: 0px; background-color: #7795BD; padding: 0px">
                            <div name="ipehtml" id="ipehtml">
                              <textarea name="WizardHTMLText" id="WizardHTMLText" rows="10" cols="50" style="display: none;"></textarea>
                            </div>
                            <div style="padding: 0px; height: 100%; width: 100%; margin: 0px; border: 1px solid transparent">
                              <table border="0" cellspacing="0" cellpadding="0" border="0" style="width:100%; height:100%; margin: 0px; padding-bottom: 6px; padding-right: 6px">
                              <tr>
                               <td style="width: 100%; height: 5%; padding: 0px; padding-left: 4px; padding-right: 4px; margin: 0px;">
                                 <div style="float: left;">
                                  <input type="image" src="images/maximize_minimize24x24.gif" width="24" height="24" id="MaxMinBtn" value="0" alt="Maximieren/Minimieren" title="Maximieren/Minimieren" style="vertical-align:middle;" />
                                 </div>
                                 <div style="float: right;">
                                  &nbsp;
                                  <input type="image" src="images/pagebodyproperties24x24.gif" width="24" height="24" onclick="document.getElementById('edit_window').contentWindow.PageBodyPropertiesEditor(); return false;" id="BodyPropertiesBtn" value="0" alt="Dokumenteigenschaften" title="Dokumenteigenschaften" style="vertical-align:middle" />
                                  &nbsp;
                                  <input type="image" src="images/print_preview24x24.gif" width="24" height="24" onclick="ShowPreview(); return false;" alt="Voransicht" title="Voransicht" style="vertical-align: middle;" id="IPEShowPreviewBtn" />
                                  &nbsp;
                                  <input type="image" src="images/templates24x24.gif" width="24" height="24" onclick="HTMLTemplatesSelectDlgOpen('CampaignEditForm', null, false, 'edit_window', true); return false;" alt="Andere E-Mail-Vorlagen" title="Andere E-Mail-Vorlagen" style="vertical-align:middle" />
                                 </div>
                               </td>
                              </tr>
                              <tr>
                               <td style="width: 100%; vertical-align: top; text-align: center; height: 95%;">
                                 <iframe class="ui-dialog-titlebar ui-corner-all ui-helper-clearfix" id="edit_window" name="edit_window" style="overflow-x: auto; overflow-y: scroll; height: 100%; width: 100%; border: 2px solid #efefef; background-color: #FFFFFF;"
                                 src="" width="100%" height="100%" scrolling="auto" frameborder="0"></iframe>
                               </td>
                              </tr>
                              </table>
                            </div>
                         </div>
                         <script>
                            $(document).ready(function(){
                              /*ipe:loadhtmltemplate*/
                              CreateFormAndPostIt("ipe_loadhtmltemplate.php?id=0", {}, "post", "edit_window");
                              /*ipe:loadhtmltemplate/*/
                              /*ipe:loadWizardHTMLText*/
                              var dstDoc = document.getElementById('edit_window').contentDocument || document.getElementById('edit_window').contentWindow.document;
                              dstDoc.open();
                              dstDoc.write( document.getElementById('WizardHTMLText').value );
                              dstDoc.close();
                              /*ipe:loadWizardHTMLText/*/
                           	});
                         </script>
                         <!-- /IPE //-->

                         </td>
                       </tr>
                     </tbody>
                   </table>
               </div>
               <!-- ####### Inner TAB END -->
               <!-- ####### Inner TAB START -->
               <script language="JavaScript" type="text/javascript">
               <!--
                 InnerTabListArray.push('E-Mail im Text-Format');

               //-->
               </script>
             	<div class="dhtmlgoodies_aTab">
                <br />
                  <table class="EditorTable" cellspacing="0" cellpadding="0" border="0" id="PlainText">
                    <tbody>
                      <tr>
                        <td colspan="2" valign="middle">

                          <select size="1" id="PlainTextPlaceHoldersCB" title="Feld in E-Mail-Text einf&uuml;gen" onchange="InsertFieldValue(this.id, this.parentNode.querySelector('textarea').id)">
                            <option selected="selected">Feld zum Einf&uuml;gen w&auml;hlen...</option>
                          </select>
                          &nbsp;
                          <input type="image" src="images/blind.gif" width="24" height="24" class="FctButton ExternalButton" onclick="DoShowFunctionsDialog(this.form.id, this.parentNode.querySelector('textarea').id, false); return false;" alt="Funktionen" title="Funktionen in E-Mail-Text einf&uuml;gen" style="vertical-align:bottom" />
                          <p>&nbsp;</p>

                          <textarea name="MailPlainText" id="MailPlainText" style="width: 99%; min-width: 874px; height: 600px" onchange="PageModified=true;"></textarea>
                        </td>
                      </tr>
                    </tbody>
                  </table>
              </div>
              <!-- ####### Inner TAB END -->

               <!-- ####### Inner TAB START -->
               <script language="JavaScript" type="text/javascript">
               <!--
                 InnerTabListArray.push('Anh&auml;nge der E-Mail');

               //-->
               </script>
             	<div class="dhtmlgoodies_aTab">
                <br />
                  <table class="EditorTable" cellspacing="0" cellpadding="0" border="0">
                    <tbody>
                      <tr>
                        <td colspan="2" valign="middle">
                          <div class="scrollbox" style="height: 560px;" name="AttachmentsScrollbox" id="AttachmentsScrollbox">
                            <Attachments>
                              <span class="scrollboxSpan"><input type="checkbox" name="Attachments[]" value="<AttachmentsName></AttachmentsName>" id="AttachmentsId" />&nbsp;<label for="AttachmentsId"><AttachmentsName></AttachmentsName></label><br /></span>
                            </Attachments>
                          </div>
                          <br />
                          <input type="button" class="button" name="AttachmentsUploadBtn" value="Neue Datei(en) &uuml;bertragen" onclick="AttachmentUpload('CampaignEditForm', 'AttachmentsScrollbox', 'Attachments[]', null, ''); return false;" style="margin-left: 0px" />&nbsp;&nbsp;
                          <input type="button" class="button" name="AttachmentsDeleteBtn" value="Datei(en) l&ouml;schen" onclick="AttachmentDelete('CampaignEditForm', 'Attachments[]', 'Attachments[]'); return false;" style="margin-left: 0px" />
                        </td>
                      </tr>
                    </tbody>
                  </table>
              </div>
              <!-- ####### Inner TAB END -->

               <!-- ####### Inner TAB START -->
               <script language="JavaScript" type="text/javascript">
               <!--
                 InnerTabListArray.push('Personalisierte Anh&auml;nge');

               //-->
               </script>
             	<div class="dhtmlgoodies_aTab">
                <br />
                  <table class="EditorTable" cellspacing="0" cellpadding="0" border="0">
                    <tbody>
                      <tr>
                        <td colspan="2" valign="middle">
                          <select name="PersAttachments[]" id="PersAttachments" style="height: 460px; width: 100%" multiple="multiple" onchange="SetPersAttachmentsButtons();">
                            <PersAttachments>
                              <option value="<AttachmentsName></AttachmentsName>"><AttachmentsName></AttachmentsName></option>
                            </PersAttachments>
                          </select>
                          <br />
                          <input type="button" class="button" name="PersAttachmentsAddBtn" value="Neuer Anhang" onclick="PersAttachmentAddEdit('CampaignEditForm', 'PersAttachments', ''); return false;" style="margin-left: 0px" />&nbsp;&nbsp;
                          <input type="button" class="button" name="PersAttachmentsEditBtn" id="PersAttachmentsEditBtn" value="Anhang &auml;ndern" onclick="var value = '';var P = document.getElementById('PersAttachments');for(var i=0; i<P.options.length; i++) {if(P.options[i].selected) {value=P.options[i].value; break;}}PersAttachmentAddEdit('CampaignEditForm', 'PersAttachments', value); return false;" style="margin-left: 0px" />&nbsp;&nbsp;
                          <input type="button" class="button" name="PersAttachmentsDeleteBtn" id="PersAttachmentsDeleteBtn" value="Anhang l&ouml;schen" onclick="RemovePersAttachments(); return false;" style="margin-left: 0px" />
                          <br /><br /><br />
                          <input type="checkbox" id="SendEMailWithoutPersAttachment" name="SendEMailWithoutPersAttachment" value="1" /><label for="SendEMailWithoutPersAttachment">&nbsp;E-Mail bei nicht existierenden Datei(en) ohne Anh&auml;nge versenden.</label>
                        </td>
                      </tr>
                    </tbody>
                  </table>
              </div>
              <!-- ####### Inner TAB END -->

              </div>
              <!-- ##### InnerTabView - END -->
              <!-- ##### InnerSpacer - END -->
              </div>


              <script type="text/javascript" src="ckeditor/ckeditor.js"></script>
              <script type="text/javascript" src="templates/default/de/ckeditor_imageresize.js"></script>

              <script type="text/javascript" src="js/ipe_common.js"></script>

              <script language="javascript" type="text/javascript">
              <!--
                initTabs('dhtmlgoodies_HTMLTexttabView', InnerTabListArray, 0, 894, 690);
                addScrollboxRolloverEffect('AttachmentsScrollbox','scrollboxRollOverEffect', null);

                function html_entity_decode( string ) {
                    var ret, tarea = document.createElement('textarea');
                    tarea.innerHTML = string;
                    ret = tarea.value;
                    tarea = null;
                    return ret;
                }

                function FillComboBoxes() {
                    var CBs = Array (
                        'SubjectPlaceHoldersCB',
                        'PlainTextPlaceHoldersCB',
                        'SinglelinePlaceHoldersCB',
                        'PlainHTMLPlaceHoldersCB'
                    )

      	            for(var j=0; j<CBs.length; j++) {
                        var CB = document.getElementById(CBs[j]);
                        if(CB == null) continue;
                        while (CB.length > 1)
                           CB.options[CB.length - 1] = null;


                        for(var i=0; i<arrPlaceholderItems.length; i++){
                          var newOption = new Option(html_entity_decode(arrPlaceholderItems[i][1]), arrPlaceholderItems[i][0], false, false);
                          CB.options[CB.length] = newOption;
                        }

                        if ( (CBs[j] == 'PlainTextPlaceHoldersCB' || (CBs[j] == 'PlainHTMLPlaceHoldersCB') )
                           ) {
                           for(var i=0; i<arrNewsletterUnsubscribePlaceholders.length; i++){
                             var newOption = new Option(html_entity_decode(arrNewsletterUnsubscribePlaceholders[i][1]), arrNewsletterUnsubscribePlaceholders[i][0], false, false);
                             CB.options[CB.length] = newOption;
                           }
                          }

                    }
                }

                $(document).ready(function(){
                  FillComboBoxes();
                })

              -->
              </script>

              <script language="javascript" type="text/javascript">
              <!--
                ShowHideEMailTexts();

                function ShowNATextOnTab(TabId, Page, fieldId) {
                  var NA="Angabe nicht notwendig";

                  var A = document.getElementById('tabView' + TabId + '_' + Page);
                  if(A == null) return;
                  var tabSpanId = 'tabView' + TabId + '_' + Page + '_NAspan';
                  var tabSpan = document.getElementById(tabSpanId);
                  if (document.getElementById(fieldId).style.display == 'none') {
                     if(tabSpan == null)
                        A.innerHTML = '<span id="' + tabSpanId + '">' + NA + '</span>' + A.innerHTML;
                        else
                        tabSpan.style.display = '';
                  } else {
                    if(tabSpan != null)
                       tabSpan.style.display = 'none';
                  }

                  // show correct tab
                  if( document.getElementById('MailFormat').selectedIndex > 0 )
                     showTab(TabId, 0);
                     else
                     showTab(TabId, 1);
                }

                function ShowHideEMailTexts() {


                  if(document.getElementById('MailFormat') != null) {

                    var el = document.getElementById('MailHTMLText');

                    if (el.removeEventListener){
                      el.removeEventListener('keydown', PlainSourceChanged, false);
                    } else if (el.detachEvent){
                      el.detachEvent('keydown', PlainSourceChanged);
                    }

                    if(myCodeMirror){
                       myCodeMirror.off("change", PlainSourceChanged);
                       document.getElementById('PlainHTMLPlaceHoldersCB').onchange = InsertFieldValue('PlainHTMLPlaceHoldersCB', 'MailHTMLText');
                    }

                    if(document.getElementById('MailFormat').selectedIndex == 0){
                        ShowItem('ToolbarPlainSource', false);
                        HideCKEditor("MailHTMLText");
                        HideIPEWizard();
                        HideCodeMirror();
                      } else {
                         if(document.getElementById('MailEditType').selectedIndex == 0) {
                             ShowItem('ToolbarPlainSource', false);
                             HideIPEWizard();
                             HideCodeMirror();
                             var iv = IsCKEditorVisible("MailHTMLText");
                             ShowCKEditor("MailHTMLText", "100%", 493, 'MyDefaultMailToolbar');
                             if(!iv)
                               AddCKEditorChangedEvent();
                            }
                            else if(document.getElementById('MailEditType').selectedIndex == 1){
                              ShowItem('ToolbarPlainSource', false);
                              HideCKEditor("MailHTMLText");
                              HideCodeMirror();
                              ShowIPEWizard();
                            }
                            else if(document.getElementById('MailEditType').selectedIndex == 2){
                              HideCKEditor("MailHTMLText");
                              HideIPEWizard();
                              HideCodeMirror();
                              ShowItem('ToolbarPlainSource', true);

                              ShowItem('MailHTMLText', true);
                              try {
                                myCodeMirror = CodeMirror.fromTextArea(el, {
                                               autoCloseBrackets: true,
                                               autoCloseTags: true,
                                               autoFormatOnStart: false,
                                               autoFormatOnUncomment: true,
                                               continueComments: true,
                                               enableCodeFolding: false,
                                               enableCodeFormatting: true,
                                               enableSearchTools: true,
                                               highlightMatches: true,
                                               indentWithTabs: false,
                                               lineNumbers: true,
                                               lineWrapping: true,
                                               mode: 'htmlmixed',
                                               matchBrackets: true,
                                               matchTags: true,
                                               showAutoCompleteButton: true,
                                               showCommentButton: true,
                                               showFormatButton: true,
                                               showSearchButton: true,
                                               showTrailingSpace: true,
                                               showUncommentButton: true,
                                               styleActiveLine: true,
                                               theme: 'default',
                                               useBeautify: false
                                               });
                                myCodeMirror.on("change", PlainSourceChanged);
                                myCodeMirror.setSize("100%", 600);
                                document.getElementById('PlainHTMLPlaceHoldersCB').onchange = function(){InsertFieldValueInCodeMirror('PlainHTMLPlaceHoldersCB', myCodeMirror);};
                              } catch(e) {myCodeMirror = null}

                              if (el.addEventListener){
                                el.addEventListener('keydown', PlainSourceChanged, false);
                              } else if (el.attachEvent){
                                el.attachEvent('keydown', PlainSourceChanged);
                              }

                            }
                        }

                    if(document.getElementById('MailEditType').selectedIndex == 0 || document.getElementById('MailEditType').selectedIndex == 2) {
                      ShowItem('HTML', document.getElementById('MailFormat').selectedIndex > 0  );
                    } else {
                      HideCodeMirror();
                      ShowItem('MailHTMLText', false  );
                    }
                    ShowItem('PlainText', document.getElementById('MailFormat').selectedIndex != 1 );
                    if( document.getElementById('MailFormat').selectedIndex  == 2)
                       document.getElementById('AutoUpdateTextPartSpan').style.display = '';
                       else
                       document.getElementById('AutoUpdateTextPartSpan').style.display = 'none';

                    if(document.getElementById('MailFormat').selectedIndex == 0){
                      document.getElementById('MailEditType').selectedIndex = 0;
                      document.getElementById('MailEditType').disabled = true;
                    } else
                      document.getElementById('MailEditType').disabled = false;

                    DisableItem('MailPreHeaderText', document.getElementById('MailFormat').selectedIndex != 0);
                  }


                  // HTML
                  ShowNATextOnTab('dhtmlgoodies_HTMLTexttabView', 0, 'HTML');

                  // TEXT
                  ShowNATextOnTab('dhtmlgoodies_HTMLTexttabView', 1, 'PlainText');

                }

                function InsertFieldValueInCodeMirror(CBId, myCodeMirror){
                    var CB = document.getElementById(CBId);
                    if(CB == null || myCodeMirror == null) return;
                     if(CB.selectedIndex > 0) {
                       myCodeMirror.replaceRange(CB.options[CB.selectedIndex].value, myCodeMirror.getCursor());
                       CB.selectedIndex = 0;
                       //CodeMirror.signal(myCodeMirror, "change", null);
                       myCodeMirror.focus();
                     }
                }

                function HideCodeMirror(){
                  if(myCodeMirror){
                     myCodeMirror.toTextArea();
                     myCodeMirror = null;
                  }
                }

                var PageModified=false;

                function PlainSourceChanged(){
                  PageModified = true;
                  return true;
                }

                function AddCKEditorChangedEvent() {

                  if(CKEDITOR.instances['MailHTMLText'] != null) {

                        CKEDITOR.on('instanceReady', function( ev ) {
                    						CKEDITOR.instances['MailHTMLText'].on('key', function (e) {
                            PageModified=true;
                            e.removeListener();
                          });

                        CKEDITOR.instances['MailHTMLText'].on('blur', function(e) {
                            if (e.editor.checkDirty()) {
                               PageModified=true;
                            }
                        });

                        AddImageSizeChangedEventToCKEditor('MailHTMLText');
                        ev.removeListener();

              				     });

                  }
                }

                window.onbeforeunload = function (e) {
                     var e = e || window.event;
                     var warntext = 'Dokument wurde ge&auml;ndert ohne die &Auml;nderungen zu speichern.';
                     if (PageModified || Modified) {
                       // For IE and Firefox prior to version 4
                       if (e) {
                           e.returnValue = html_entity_decode(warntext);
                           if(e.returnValue)
                             ResetCurrentUserEditFlag();
                       }

                       // For Safari
                       var b = html_entity_decode(warntext);
                       if(b)
                         ResetCurrentUserEditFlag();
                       return b;
                     }else
                       ResetCurrentUserEditFlag();
                }

                AddCKEditorChangedEvent();


                function RemovePersAttachments() {
                   var P = document.getElementById("PersAttachments");
                   for(var i=P.options.length - 1; i>=0; i--) {
                     if(P.options[i].selected) {
                        P.options[i] = null;
                     }
                   }
                   SetPersAttachmentsButtons();
                }

                // onformsubmit select all!
                function SelectAllPersAttachments() {
                   var P = document.getElementById("PersAttachments");
                   for(var i=P.options.length - 1; i>=0; i--) {
                     P.options[i].selected = true;
                   }
                }

                function SetPersAttachmentsButtons(){
                  document.getElementById('PersAttachmentsEditBtn').disabled = document.getElementById('PersAttachments').value == '';
                  document.getElementById('PersAttachmentsDeleteBtn').disabled = document.getElementById('PersAttachments').value == '';
                }

                function AddEditPersAttachment(newFileName, oldFileName){

                   var SourceElement = document.getElementById('PersAttachments');
                   var Exists = false;
                   var newOption = null;
                   for(var i=0; i<SourceElement.options.length; i++) {

                      if(oldFileName == "" && SourceElement.options[i].value.toLowerCase() == newFileName.toLowerCase()) {
                         Exists = true;
                         break;
                      }

                      if(oldFileName != "" && oldFileName.toLowerCase() != SourceElement.options[i].value.toLowerCase() && SourceElement.options[i].value.toLowerCase() == newFileName.toLowerCase()) {
                         Exists = true;
                         break;
                      }

                      if(oldFileName != "" && oldFileName.toLowerCase() == SourceElement.options[i].value.toLowerCase())
                        newOption = SourceElement.options[i];
                   }

                   if(Exists){
                     return 1000;
                   }

                   if(oldFileName == ""){
                     newOption = new Option(newFileName, newFileName, false, true);
                     newOption.selected = true;
                     SourceElement.options[SourceElement.options.length] = newOption;
                   } else if(newOption) {
                     newOption.text = newFileName;
                     newOption.value = newFileName;
                   }

                   SetPersAttachmentsButtons();
                   return true;
                }

                SetPersAttachmentsButtons();

              -->
              </script>


              <!-- ##### TabView - END -->

            </td>
          </tr>


        </tbody>
      </table>


      <input type="submit" name="PrevBtn" value="&lt; Zur&uuml;ck" id="PrevBtn" class="FormButton" onclick="PrevBtnClicked=true;" />
      <input type="submit" name="NextBtn" value="Speichern und Weiter &gt;" class="FormButton" id="NextBtn" onclick="PrevBtnClicked=false; PageModified=false; Modified=false;;this.style['pointer-events']='none';" />


      <script type="text/javascript">
      <!--
        //AUTO_SCRIPT_CODE_PLACEHOLDER//
      //-->
      </script>

      </form>

      <IF:IS_CAMPAIGNSENDING>
      <script language="JavaScript">
      <!--
        MessageBox("Warnung", "Das E-Mailing wird gerade versendet oder ist f&uuml;r den Versand vorgesehen.<br /><br />Sollten Sie &Auml;nderungen am E-Mail-Text vornehmen, dann werden die &Auml;nderungen an die Empf&auml;nger gesendet, die bisher noch nicht die E-Mail erhalten haben.", messageTypeWarning, 400, 168, "", true);
      //-->
      </script>
      </IF:IS_CAMPAIGNSENDING>

      <IF:IS_CAMPAIGNEDITEDBYANOTHERUSER>
      <script language="JavaScript">
      <!--
        MessageBox("Warnung", "Der E-Mail-Text dieses E-Mailings wird von Nutzer <b><Username></b> seit <EditDateTime> Uhr bearbeitet.<br /><br />Sollten Sie &Auml;nderungen am E-Mail-Text vornehmen und speichern, dann k&ouml;nnten die &Auml;nderungen des anderen Nutzers oder Ihre eigenen &Auml;nderungen verloren gehen.", messageTypeWarning, 400, 168, "", true);
      //-->
      </script>
      </IF:IS_CAMPAIGNEDITEDBYANOTHERUSER>


<script language="JavaScript">
<!--

var PrevBtnClicked = false;
var oldSetupLevel = -1;
var IsResetCurrentUserEditFlagDone = false;

function ResetCurrentUserEditFlag(){
  if (IsResetCurrentUserEditFlagDone) return;
  var date = new Date();
  var nocache = date.getTime() / 1000;
  $.ajaxSetup({ cache: false });

 	jQuery.get('campaignedit.php' + "?nocache=" + nocache + "&ResetCurrentUserEditFlag=" + document.getElementById('CampaignListId').value, "", function(data){
     console.log(data);
 	});
  if(window.navigator.userAgent.indexOf("Firefox") > -1 || window.navigator.userAgent.indexOf("Waterfox") > -1) // FF waiting
    Sleep(500);
  IsResetCurrentUserEditFlagDone = true;
}

function ConfirmLeavePageWithoutSavingEvent(value){
  if(value){
     ResetCurrentUserEditFlag();
     PageModified = false;
     Modified = false;
     if(!PrevBtnClicked)
       $("#CampaignEditForm").submit();
       else{
         document.CampaignEditForm.action='./campaignedit.php';
         $("#PrevBtn").trigger("click");
       }
  }else{
    RemoveLoadingStatusOnSubmit();
    PrevBtnClicked = false;
    document.CampaignEditForm.action='./campaignedit.php';
    if(oldSetupLevel > -1)
      document.getElementById('SetupLevel').value = oldSetupLevel;
    oldSetupLevel = -1;
  }
}

$(document).ready(function(){
  InsertLoadingStatusOnSubmit();

  $("#CampaignEditForm").on("submit", function() {
       if (PageModified || Modified) {
         var warntitle = 'Warnung';
         var warntext = 'Dokument wurde ge&auml;ndert ohne die &Auml;nderungen zu speichern.';
         warntext += '<br /><br />M&ouml;chten Sie die Seite wirklich verlassen ohne zu speichern?';
         RemoveLoadingStatusOnSubmit();
         MessageBox(warntitle, warntext, messageTypeConfirmation, 380, 150, "ConfirmLeavePageWithoutSavingEvent", false);
         return false;
       }
       showLoading(true);
       if(document.getElementById('MailEditType').selectedIndex == 1)
         SaveIPE(false);
       CheckAndRemoveCriticalChars('CampaignEditForm');
       SelectAllPersAttachments();
       return true;
  });

});

$(document).ready(function(){

  $("#NextBtn").on('mousedown keydown', function(e){
     showLoading(true);
  });

  $("#NextBtn").on('mouseup mouseout', function(e){
     showLoading(false);
  });


  $("#NextBtn").on('click', function(e){
    var $el = $(this);
    if($el.data('clicked')){
      // Previously clicked, stop actions
      console.log("!!!DblClick on save button detected");
      e.preventDefault();
      e.stopPropagation();
    }else{
      // Mark to ignore next click
      $el.data('clicked', true);
      // Unmark after 1 second
      window.setTimeout(function(){
        $el.removeData('clicked');
      }, 1000)
    }
    IsResetCurrentUserEditFlagDone = true; // we must not reset it
    return true;
  });

});

//-->
</script>

<!-- IPE //-->
<!-- IPE_DIALOGS //-->
<!-- /IPE //-->

